!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.VueGis3DBridge=e():t.VueGis3DBridge=e()}(window,function(){return n={},i.m=r=[function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.FACTOR=1.5,e.MIN_ZOOM=3,e.STYLE={pulseRadius:10,arcWidth:1,label:!0}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getDistance=function(t,e){function r(t){return t*t}return Math.sqrt(r(t)+r(e))},e.getLineCenter=function(t,e){var r=(t+e)/2;return(t-e)*n.FACTOR+r},e.extend=function(t,r){var n=void 0,i=void 0;return t.forEach(function(t){var e=r(t);void 0===n?n=i=e:(e<n&&(n=e),i<e&&(i=e))}),[n,i]},e.getType=function(t){return Object.prototype.toString.call(t).slice(8,-1)};var n=r(0)},function(t,e,r){"use strict";function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0});var i=(function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}(o,[{key:"draw",value:function(t){t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),Object.assign(t,{lineWidth:this.borderWidth||0,strokeStyle:this.borderColor||"#000",fillStyle:this.color||"#000"}),t.beginPath(),"circle"===this.style?t.arc(0,0,this.size,0,2*Math.PI,!1):"arrow"===this.style&&(t.moveTo(-this.size,-this.size),t.lineTo(this.size,0),t.lineTo(-this.size,this.size),t.lineTo(-this.size/4,0),t.lineTo(-this.size,-this.size)),t.closePath(),t.stroke(),t.fill(),t.restore()}}]),o);function o(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.style=t.style,this.color=t.color,this.size=t.size,this.borderWidth=t.borderWidth,this.borderColor=t.borderColor}e.default=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t};function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var y=r(0),b=r(1);var o=(n(g,[{key:"draw",value:function(){}}]),g);function g(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,g);var e=t.startX,r=t.startY,n=t.endX,i=t.endY,o=t.width,a=t.color,s=void 0===a?"#fff":a,l=(0,b.getDistance)(e-n,r-i),u=(e+n)/2,c=(r+i)/2,h=(r-i)*y.FACTOR+u,f=(n-e)*y.FACTOR+c,d=(0,b.getDistance)(l/2,l*y.FACTOR),p=Math.atan2(r-f,e-h),v=Math.atan2(i-f,n-h);Object.assign(this,{startX:e,startY:r,endX:n,endY:i,centerX:h,centerY:f,startAngle:p,endAngle:v,radius:d,color:s,lineWidth:o||1})}e.default=o},function(t,e,r){"use strict";var n,a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},s=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=r(5),o=(n=i)&&n.__esModule?n:{default:n},l=r(0);L.MigrationLayer=L.Layer.extend({initialize:function(t,e){var r=0<arguments.length&&void 0!==t?t:[],n=e;Object.assign(this,{_data:r,options:n}),this._show=!0},onAdd:function(t){return this._map=t,this._init(),this._bindMapEvents(),this._draw(),this},onRemove:function(t){return L.DomUtil.remove(this.container),t.clearAllEventListeners(),this.migration.clear(),this.mapHandles=[],this},setData:function(t){return this._data=t,this._draw(),this},setStyle:function(t){return this.migration.setStyle(t),this},hide:function(){return this.container.style.display="none",this},show:function(){return this.container.style.display="",this._show=!0,this},play:function(){return this.migration.play(),this},pause:function(){return this.migration.pause(),this},_init:function(){var t=L.DomUtil.create("div","leaflet-ODLayer-container");this.container=t;var e=this._map.getSize(),r=e.x,n=e.y;Object.assign(t.style,{position:"absolute",width:r+"px",height:n+"px"});var i=document.createElement("canvas");this.canvas=i,t.appendChild(i),this._map.getPanes().overlayPane.appendChild(t),this.migration=new o.default({canvas:i,container:t,map:this._map,data:this._convertData(),options:this.options})},_bindMapEvents:function(){var e=this;this._map.on("moveend",function(t){t.target.getZoom()<l.MIN_ZOOM?e.hide():(e._show||e.show(),e.migration.play(),e._draw())}),this._map.on("zoomstart ",function(){e.container.style.display="none"}),this._map.on("zoomend",function(){e._show&&(e.container.style.display="",e._draw())})},_draw:function(){this._map.getBounds()&&this.migration.playAnimation&&(this._resize(),this.migration.setData(this._convertData()))},_convertData:function(){var o=this._map,t=this._data,e=o.getBounds();if(t&&e){var i=function(t){var e=s(t,2),r=e[0],n=e[1],i=o.latLngToContainerPoint(new L.LatLng(n,r));return[i.x,i.y]};return t.map(function(t){var e=t.from,r=t.to,n=function(t,e){var r={};for(var n in t)0<=e.indexOf(n)||Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return r}(t,["from","to"]);return a({from:i(e),to:i(r)},n)})}return[]},_resize:function(){var t=this._map.getBounds().getNorthWest(),e=this._map.latLngToContainerPoint(t).y;this.container.style.top=0<e?-e+"px":"0px";var r=window.getComputedStyle(this._map.getContainer());this.canvas.setAttribute("width",parseInt(r.width,10)),this.canvas.setAttribute("height",parseInt(r.height,10));var n=this._map.latLngToLayerPoint(t);L.DomUtil.setPosition(this.container,n)}}),L.migrationLayer=function(t,e){return new L.MigrationLayer(t,e)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t};function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},b=s(r(2)),g=s(r(6)),m=s(r(7)),w=s(r(8)),o=r(1),a=r(0),u=s(r(9));function s(t){return t&&t.__esModule?t:{default:t}}function c(t,e){var r={};for(var n in t)0<=e.indexOf(n)||Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return r}function h(t){return t?l({},a.STYLE,t):a.STYLE}var f=(n(d,[{key:"setStyle",value:function(t){this.style=h(t),this.refresh()}},{key:"setData",value:function(t){this.data=t,this.refresh()}},{key:"refresh",value:function(){var c=this,t=this.data;if(t&&0!==t.length){this.clear();var h=(0,o.extend)(t,function(t){return t.value}),f=this.popover,d=this.container,e=this.style,p=e.arcWidth,v=e.pulseRadius,y=e.label;t.forEach(function(t,e){var r=t.from,n=t.to,i=t.labels,o=t.color,a=new g.default({startX:r[0],startY:r[1],endX:n[0],endY:n[1],labels:i,label:y,width:p,color:o}),s=new b.default({x:n[0],y:n[1],rotation:a.endAngle+Math.PI/2,options:"arrow",color:o,size:4,borderWidth:0,borderColor:o}),l=new m.default({x:n[0],y:n[1],dataRange:h,radius:v,zoom:c.map.getZoom(),container:d,index:e,data:t,popover:f}),u=new w.default({startX:r[0],startY:r[1],endX:n[0],endY:n[1],width:15,color:o});c.store.arcs.push(a),c.store.markers.push(s),c.store.pulses.push(l),c.store.sparks.push(u)}),this.start()}}},{key:"clear",value:function(){this.store.pulses.forEach(function(t){return t.clear()}),this.store={arcs:[],markers:[],pulses:[],sparks:[]},this.playAnimation=!0,this.started=!1,window.cancelAnimationFrame(this.requestAnimationId)}},{key:"start",value:function(){var e=this,t=this.started,i=this.store,o=this.context,r=this.canvas,n=r.width,a=r.height;t||(!function t(){e.requestAnimationId=window.requestAnimationFrame(t),e.playAnimation&&(o.clearRect(0,0,n,a),Object.keys(i).forEach(function(t){var e=i[t];e.forEach(function(t){return t.draw(o)});for(var r=0,n=e.length;r<n;r++)e[r].draw(o)}))}(),this.started=!0)}},{key:"play",value:function(){this.playAnimation=!0}},{key:"pause",value:function(){this.playAnimation=!1}}]),d);function d(t){var e=t.options,r=t.container,n=c(t,["options","container"]);!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d);var i=e.replacePopover,o=e.onShowPopover,a=e.onHidePopover,s=c(e,["replacePopover","onShowPopover","onHidePopover"]);Object.assign(this,l({},n,{container:r,style:h(s),playAnimation:!0,started:!1,store:{arcs:[],markers:[],pulses:[],sparks:[]}})),this.popover=new u.default({replacePopover:i,onShowPopover:o,onHidePopover:a,container:r}),this.context=this.canvas.getContext("2d")}e.default=f},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t};function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o,a=r(3);var s=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(u,((o=a)&&o.__esModule?o:{default:o}).default),n(u,[{key:"draw",value:function(t){if(t.save(),Object.assign(t,{lineWidth:this.lineWidth,strokeStyle:this.color,fillStyle:this.strokeStyle}),t.beginPath(),t.arc(this.centerX,this.centerY,this.radius,this.startAngle,this.endAngle,!1),t.stroke(),t.restore(),t.save(),this.label){var e=l(this.labels,2),r=e[0],n=e[1];if(Object.assign(t,{font:this.font}),r){var i=this.startX-15,o=this.startY+5;t.fillText(r,i,o)}if(n){var a=this.endX-15,s=this.endY-5;t.fillText(n,a,s)}}t.restore()}}]),u);function u(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,t)),r=t.labels,n=t.font,i=t.label;return Object.assign(e,{font:n,label:i,labels:r}),e}e.default=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=[],i=(function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}(y,[{key:"clear",value:function(){s.push(this.pulse),this.pulse.removeEventListener("mouseover",this.showPopover),this.pulse.removeEventListener("mouseout",this.hidPopover),this.container.removeChild(this.pulse)}},{key:"initDom",value:function(){if(0<s.length){this.pulse=s.pop();var t=v(this.pulse.children,1);this.ring=t[0]}else this.pulse=document.createElement("div"),this.ring=document.createElement("div"),this.pulse.appendChild(this.ring);var e=this.x,r=this.y,n=this.r,i=this.color,o=this.pulse,a=this.ring;Object.assign(o.style,{position:"absolute",zIndex:"1",borderRadius:"50%",width:2*n+"px",height:2*n+"px",left:"-"+n+"px",top:"-"+n+"px",background:i,transform:"translate("+e+"px, "+r+"px)"}),Object.assign(a.style,{position:"absolute",borderRadius:"50%",width:2*n+"px",height:2*n+"px",left:"-1px",top:"-1px",border:"1px solid "+i}),this.container.appendChild(o),this.pulse.addEventListener("mouseover",this.showPopover),this.pulse.addEventListener("mouseout",this.hidPopover)}},{key:"draw",value:function(){var t=this.scale;Object.assign(this.ring.style,{transform:"scale("+t+")"}),this.scale+=.02,2<t&&(this.scale=1)}}]),y);function y(t){var e=t.x,r=t.y,n=t.container,i=t.dataRange,o=t.zoom,a=t.data,s=t.index,l=t.popover,u=t.radius;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,y);var c=a.color,h=a.value,f=a.labels,d=(u/2+h*u/v(i,2)[1])*o/6,p=3<d?d:3;Object.assign(this,{x:e,y:r,color:c,container:n,value:h,labels:f,r:p,scale:1}),this.showPopover=function(t){var e=t.clientX,r=t.clientY;l.show(e,r,a,s)},this.hidPopover=function(){return l.hide(s)},this.initDom()}e.default=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t};function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=s(r(3)),a=s(r(2));function s(t){return t&&t.__esModule?t:{default:t}}var l=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(u,o.default),n(u,[{key:"drawArc",value:function(t,e,r,n,i){t.save(),Object.assign(t,{lineWidth:r,strokeStyle:e,shadowColor:e,lineCap:"round"}),t.beginPath(),t.arc(this.centerX,this.centerY,this.radius,n,i,!1),t.stroke(),t.restore()}},{key:"draw",value:function(t){var e=this.endAngle,r=this.trailAngle,n=this.factor,i=this.color,o=this.deltaAngle,a=r+n,s=i;this.animateBlur&&(this.arcAngle=a),this.trailAngle=a,this.drawArc(t,s,this.lineWidth,this.startAngle,this.arcAngle);for(var l=this.tailPointsCount,u=0;u<l;u++){var c=i;r-o*u>this.startAngle&&this.drawArc(t,c,5-5/l*u,r-o*u,r)}t.save(),t.translate(this.centerX,this.centerY),this.marker.x=Math.cos(this.trailAngle)*this.radius,this.marker.y=Math.sin(this.trailAngle)*this.radius,this.marker.rotation=this.trailAngle+Math.PI/2,this.marker.draw(t),t.restore(),180*(e-this.trailAngle)/Math.PI<.5&&(this.trailAngle=this.startAngle,this.animateBlur=!1)}}]),u);function u(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,t));return e.tailPointsCount=50,e.factor=1/e.radius,e.deltaAngle=80/Math.min(e.radius,400)/e.tailPointsCount,e.trailAngle=e.startAngle,e.arcAngle=e.startAngle,e.marker=new a.default({x:50,y:80,rotation:50*Math.PI/180,style:"arrow",color:"rgb(255, 255, 255)",size:3,borderWidth:0,borderColor:e.color}),e}e.default=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t};function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var c=r(1);var o=(n(a,[{key:"show",value:function(t,e,r,n){var i=r.value,o=r.labels,a=this.el,s=this.replace,l=this.onShow;if(s){var u=s(t,e,r,n);a.replaceChild(u,a.children[0])}else this.context.innerText=o[0]+" -> "+o[1]+": "+i;"Function"===(0,c.getType)(l)&&l(r,n),Object.assign(a.style,{display:"",transform:"translate("+t+"px, "+e+"px)"})}},{key:"hide",value:function(t){var e=this.el,r=this.onHide;"Function"===(0,c.getType)(r)&&r(data,t),e.style.display="none"}}]),a);function a(t){var e=t.onShowPopover,r=t.onHidePopover,n=t.container,i=t.replacePopover;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),this.el=L.DomUtil.create("div","",n),Object.assign(this.el.style,{position:"absolute",left:0,top:0,display:"none",zIndex:"11"}),this.context=L.DomUtil.create("div","",this.el),"Function"===(0,c.getType)(i)?this.replace=i:Object.assign(this.context.style,{border:"1px solid grey",background:"rgba(255,255,255,.3)",borderRadius:"5px",padding:"8px 16px"}),Object.assign(this,{onShow:e,onHide:r})}e.default=o}],i.c=n,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=4);function i(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var r,n});